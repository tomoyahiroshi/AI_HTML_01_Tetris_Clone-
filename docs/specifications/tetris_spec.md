# テトリス仕様書（Webブラウザ版）

## 1. 文書情報
- 文書名: Webブラウザ版テトリス仕様書
- バージョン: 1.0.0
- 作成日: 2026-02-14
- 対象読者: 開発者、テスター、UI/UX設計者

---

## 2. 目的
本仕様書は、モダンブラウザ上で動作するシングルプレイのテトリスを実装するための要件を定義する。
本書により、実装・テスト・受け入れ判定の基準を統一する。

---

## 3. 対象範囲
### 3.1 対象
- 1人用テトリスゲーム本体
- ゲームプレイUI（盤面、次ミノ、ホールド、スコア表示）
- 入力操作（キーボード）
- ゲーム進行（落下、固定、ライン消去、レベルアップ、ゲームオーバー）

### 3.2 対象外（初期リリース）
- ネットワーク対戦
- ユーザーアカウント機能
- オンラインランキング
- サウンド編集機能
- モバイル向けタッチ最適化（将来対応）

---

## 4. 動作環境
- 対応ブラウザ（最新版）
  - Google Chrome
  - Microsoft Edge
  - Firefox
  - Safari
- 実行環境: デスクトップPC
- 前提:
  - JavaScript有効
  - ローカルストレージ利用可能

---

## 5. 用語定義
- **ミノ（Tetromino）**: 4ブロックで構成される落下ピース
- **盤面（Board/Field）**: ミノを配置する格子領域
- **ゴースト**: 現在ミノの着地点を示す半透明表示
- **ホールド**: ミノを一時保存し、別ミノと交換する機能
- **Bag方式**: 7種ミノを1セットとしてランダム順に払い出す方式
- **ロックディレイ**: 接地後、固定されるまでの猶予時間

---

## 6. ゲームルール仕様
### 6.1 盤面サイズ
- 有効表示領域: 幅10マス × 高さ20マス
- 内部管理領域: 高さ20 + 上部バッファ行（例: 2～4行）

### 6.2 ミノ種類
- I, O, T, S, Z, J, L の7種類
- 各ミノは回転状態を持つ（0°, 90°, 180°, 270°）

### 6.3 出現ルール
- 7-Bag方式で抽選
- 初期出現位置は中央付近
- 出現時に衝突している場合はゲームオーバー

### 6.4 落下・接地・固定
- 一定間隔で1マス自動落下（重力）
- 床または他ブロックに接触で接地状態
- 接地後、ロックディレイ経過で固定
- ロックディレイ中に移動/回転成功でロックディレイを再計測可（上限回数を設定）

### 6.5 ライン消去
- 横1列が全て埋まると消去
- 同時消去数: 1～4ライン
- 消去後、上部ブロックは落下

### 6.6 ゲームオーバー
- 新規ミノ生成時に有効位置へ配置できない場合
- ゲームオーバー演出後、リトライ可能

---

## 7. 操作仕様（キーボード）
- 左移動: `←`
- 右移動: `→`
- ソフトドロップ: `↓`（押下中は落下速度上昇）
- ハードドロップ: `Space`
- 左回転: `Z`
- 右回転: `X` または `↑`
- ホールド: `C` または `Shift`
- 一時停止: `P` または `Esc`

### 7.1 入力の挙動
- 左右移動はDAS/ARRを考慮した連続入力に対応
- ハードドロップ時は即時固定
- ホールドは1ミノにつき1回まで（固定後に再度使用可）

---

## 8. 回転仕様
- 回転方式: SRS（Super Rotation System）準拠
- 壁蹴り（Wall Kick）を実装
- Iミノは専用キックテーブルを使用

---

## 9. スコア・レベル仕様
### 9.1 スコア算出（例）
- 1ライン: 100 × レベル
- 2ライン: 300 × レベル
- 3ライン: 500 × レベル
- 4ライン（Tetris）: 800 × レベル
- ソフトドロップ: 1 × 落下マス
- ハードドロップ: 2 × 落下マス

### 9.2 レベル
- 10ライン消去ごとにレベル+1
- レベル上昇で自動落下速度を増加

### 9.3 表示項目
- 現在スコア
- 現在レベル
- 累計消去ライン
- ハイスコア（ローカル保存）

---

## 10. UI/画面仕様
### 10.1 画面構成
- 中央: メイン盤面
- 左（または右）: ホールド表示
- 反対側: Nextキュー（最低3個、推奨5個）
- 上部: スコア/レベル/ライン
- オーバーレイ: Pause / Game Over

### 10.2 視覚要件
- ミノごとに識別可能な固定色
- ゴーストは低不透明度で表示
- 消去時に簡易エフェクト（点滅等）
- 背景とブロックのコントラスト比を確保

### 10.3 レスポンシブ
- 主要ターゲットは横幅1024px以上
- 768px以上ではUI崩れなく表示
- 768px未満は縮小表示（操作性は将来改善）

---

## 11. 状態遷移仕様
- `Title` → `Playing`
- `Playing` ↔ `Paused`
- `Playing` → `LineClear`（内部短時間状態）→ `Playing`
- `Playing` → `GameOver`
- `GameOver` → `Title` または `Playing`（リスタート）

---

## 12. 非機能要件
### 12.1 パフォーマンス
- 60 FPSを目標
- 入力遅延を体感で感じないこと
- 長時間プレイ（30分）で顕著なFPS低下がないこと

### 12.2 保守性
- ロジック層と描画層を分離
- 定数（速度テーブル、スコア、キー設定）を外部化
- 単体テスト可能な設計（衝突判定、回転、ライン消去）

### 12.3 可用性
- ページ再読み込み後もハイスコア維持
- 主要操作に対しUI応答が停止しない

---

## 13. データ仕様
### 13.1 永続化データ（localStorage）
- `tetris.highScore`: 数値
- `tetris.keyBindings`（任意）: JSON
- `tetris.settings`（任意）: JSON（音量、表示設定など）

### 13.2 保存タイミング
- ゲームオーバー時
- 設定変更時

---

## 14. エラーハンドリング
- localStorageが利用不可の場合:
  - 警告をコンソールに出力
  - ハイスコア保存なしでゲーム継続
- 想定外エラー時:
  - ゲームループ停止
  - ユーザー向けに再読み込み案内

---

## 15. 受け入れ基準
1. 基本操作（移動/回転/落下/ホールド）が仕様どおり動作する。
2. ライン消去・スコア加算・レベルアップが正しく反映される。
3. ゲームオーバー条件が正しく判定される。
4. 主要ブラウザで起動・プレイできる。
5. ハイスコアが再読み込み後も保持される（localStorage利用可能時）。

---

## 16. 今後の拡張候補
- モバイル向け仮想パッド
- サウンド/BGM
- アニメーション強化
- オンラインランキング
- 対戦モード（Garbage line）

